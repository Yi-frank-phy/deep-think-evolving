============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0
rootdir: D:\deep think\deep-think-evolving
configfile: pytest.ini
plugins: anyio-4.9.0, langsmith-0.4.4
collected 33 items

tests\test_acceptance_report.py ....                                     [ 12%]
tests\test_codex_task_launcher.py ..                                     [ 18%]
tests\test_context_manager.py ....                                       [ 30%]
tests\test_diversity_calculator.py ....                                  [ 42%]
tests\test_embedding_client.py F.F                                       [ 51%]
tests\test_generate_acceptance_report.py ...                             [ 60%]
tests\test_google_grounding.py ...                                       [ 69%]
tests\test_logging_helper.py ....                                        [ 81%]
tests\test_main_pipeline.py ..                                           [ 87%]
tests\test_pipeline_smoke.py s                                           [ 90%]
tests\test_server.py .                                                   [ 93%]
tests\test_strategy_architect.py .                                       [ 96%]
tests\test_strategy_pipeline.py .                                        [100%]

================================== FAILURES ===================================
___________________________ test_embed_text_success ___________________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x000001226E0F5BF0>

    def test_embed_text_success(monkeypatch):
        def fake_post(url, headers, data):
            body = json.loads(data)
            assert body["prompt"] == "hello"
            return DummyResponse({"embedding": [0.1, 0.2, 0.3]})
    
        monkeypatch.setattr(ec.requests, "post", fake_post)
    
        vector = ec.embed_text("hello")
>       assert vector == [0.1, 0.2, 0.3]
E       assert [] == [0.1, 0.2, 0.3]
E         
E         Right contains 3 more items, first extra item: 0.1
E         Use -v to get more diff

tests\test_embedding_client.py:31: AssertionError
---------------------------- Captured stdout call -----------------------------
[ERROR] Failed to embed text: test_embed_text_success.<locals>.fake_post() got an unexpected keyword argument 'json'
__________________ test_embed_strategies_handles_http_error ___________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x000001226E112250>

    def test_embed_strategies_handles_http_error(monkeypatch):
        def fake_post(url, headers, data):
            return DummyResponse({}, status_code=500)
    
        monkeypatch.setattr(ec.requests, "post", fake_post)
    
        strategies = [{"strategy_name": "A", "rationale": "", "initial_assumption": ""}]
        result = ec.embed_strategies(strategies)
>       assert result[0]["embedding"] == []
               ^^^^^^^^^
E       IndexError: list index out of range

tests\test_embedding_client.py:52: IndexError
---------------------------- Captured stdout call -----------------------------
  Embedding strategy 1/1 using Ollama: 'A'...

[ERROR] An unexpected error occurred during embedding strategy 1: test_embed_strategies_handles_http_error.<locals>.fake_post() got an unexpected keyword argument 'json'
=========================== short test summary info ===========================
FAILED tests/test_embedding_client.py::test_embed_text_success - assert [] ==...
FAILED tests/test_embedding_client.py::test_embed_strategies_handles_http_error
=================== 2 failed, 30 passed, 1 skipped in 7.70s ===================
