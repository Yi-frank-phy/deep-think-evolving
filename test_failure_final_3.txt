============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0
rootdir: D:\deep think\deep-think-evolving
configfile: pytest.ini
plugins: anyio-4.9.0, langsmith-0.4.4
collected 33 items

tests\test_acceptance_report.py ....                                     [ 12%]
tests\test_codex_task_launcher.py ..                                     [ 18%]
tests\test_context_manager.py ....                                       [ 30%]
tests\test_diversity_calculator.py ....                                  [ 42%]
tests\test_embedding_client.py ..F                                       [ 51%]
tests\test_generate_acceptance_report.py ...                             [ 60%]
tests\test_google_grounding.py ...                                       [ 69%]
tests\test_logging_helper.py ....                                        [ 81%]
tests\test_main_pipeline.py ..                                           [ 87%]
tests\test_pipeline_smoke.py s                                           [ 90%]
tests\test_server.py .                                                   [ 93%]
tests\test_strategy_architect.py .                                       [ 96%]
tests\test_strategy_pipeline.py .                                        [100%]

================================== FAILURES ===================================
__________________ test_embed_strategies_handles_http_error ___________________

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000202F5A92650>

    def test_embed_strategies_handles_http_error(monkeypatch):
        def fake_post(url, headers=None, data=None, json=None, **kwargs):
            return DummyResponse({}, status_code=500)
    
        monkeypatch.setattr(ec.requests, "post", fake_post)
    
        strategies = [{"strategy_name": "A", "rationale": "", "initial_assumption": ""}]
        result = ec.embed_strategies(strategies)
>       assert result[0]["embedding"] == []
               ^^^^^^^^^
E       IndexError: list index out of range

tests\test_embedding_client.py:59: IndexError
---------------------------- Captured stdout call -----------------------------
  Embedding strategy 1/1 using Ollama: 'A'...

[ERROR] HTTP error during embedding: 
Response from server: {}
=========================== short test summary info ===========================
FAILED tests/test_embedding_client.py::test_embed_strategies_handles_http_error
=================== 1 failed, 31 passed, 1 skipped in 7.94s ===================
